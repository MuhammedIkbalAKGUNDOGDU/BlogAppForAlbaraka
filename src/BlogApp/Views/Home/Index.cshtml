@{
    ViewData["Title"] = "Ana Sayfa";
}

<div class="container mt-4">
    <h1 class="mb-4">Blog Yazıları</h1>

    <div id="postsContainer">
        <div class="text-center">
            <div class="spinner-border" role="status">
                <span class="visually-hidden">Yükleniyor...</span>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    loadPosts();
});

async function loadPosts() {
    try {
        const res = await fetch('/api/blogpost/published');
        if (res.ok) {
            const posts = await res.json();
            const container = document.getElementById('postsContainer');
            
            if (posts.length === 0) {
                container.innerHTML = '<div class="alert alert-info">Henüz yayınlanmış yazı bulunmamaktadır.</div>';
                return;
            }

            container.innerHTML = posts.map(post => `
                <div class="card mb-4 shadow-sm" style="cursor: pointer;" onclick="window.location.href='/BlogPost/Details?id=${post.id}'">
                    ${post.coverImage ? `<img src="${post.coverImage}" class="card-img-top" alt="${post.title}" style="max-height: 300px; object-fit: cover;">` : ''}
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <h5 class="card-title">${post.title}</h5>
                            <span class="badge bg-secondary">${post.category.name}</span>
                        </div>
                        <p class="card-text">${post.content.substring(0, 200)}${post.content.length > 200 ? '...' : ''}</p>
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <small class="text-muted">
                                    <i class="bi bi-person"></i> ${post.user.firstName} ${post.user.lastName} | 
                                    <i class="bi bi-calendar"></i> ${new Date(post.createdAt).toLocaleDateString('tr-TR')} | 
                                    <i class="bi bi-eye"></i> ${post.viewCount} görüntüleme
                                </small>
                            </div>
                            <div>
                                <span class="badge bg-primary me-2">
                                    <i class="bi bi-chat"></i> ${post.commentCount} Yorum
                                </span>
                                <span class="badge bg-danger">
                                    <i class="bi bi-heart"></i> ${post.likeCount} Beğeni
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        } else {
            document.getElementById('postsContainer').innerHTML = '<div class="alert alert-danger">Yazılar yüklenemedi.</div>';
        }
    } catch (error) {
        document.getElementById('postsContainer').innerHTML = '<div class="alert alert-danger">Bir hata oluştu.</div>';
    }
}
</script>
